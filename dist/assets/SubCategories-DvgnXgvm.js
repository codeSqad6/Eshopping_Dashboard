import{r as d,j as e,y as m,u as T}from"./index-BSaub562.js";import{a as E}from"./index-Dq7h7Pqt.js";import{o as N,p as k,q as D,T as h,r as w,B as y,s as W}from"./DefaultLayout-DOslQB01.js";/* empty css                             */import"./Widgets-Dr7HoJi5.js";const O=({open:x,onClose:u,onSave:j,initialData:n})=>{const[s,l]=d.useState({nameEn:"",nameAr:"",categoryId:"",descriptionEn:"",descriptionAr:"",status:""}),[b,v]=d.useState([]),g=async()=>{try{const t=await W();v(t),console.log("categories",b)}catch(t){console.error("Error fetching products:",t)}};d.useEffect(()=>{g()},[]);const A=t=>{const a=t.target.files[0];a&&a.type.startsWith("image/")?l(r=>({...r,image:a})):(l(r=>({...r,image:null})),m.error("Please select a valid image file"))},p=t=>{const{name:a,value:r,type:f,files:C}=t.target;l(S=>({...S,[a]:f==="file"?C[0]:r}))},o=async()=>{var t;if(s.nameEn)try{const a=sessionStorage.getItem("token"),r=new FormData;if(s.image&&s.image instanceof File)r.append("Image",s.image);else{m.error("Please upload a valid image");return}r.append("Name",s.nameEn),r.append("NameAr",s.nameAr),r.append("CategoryId",s.categoryId),r.append("Description",s.descriptionEn||""),r.append("DescriptionAr",s.descriptionAr||""),r.append("CategoryId",s.categoryId),r.append("IsActive",s.status);const f=await E.post("http://test.smartsto0re.shop/api/SubCategories",r,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${a}`}});m.success("subCat added successfully!"),console.log(f.data),j(f.data),u()}catch(a){console.error("❌ Error Response:",((t=a.response)==null?void 0:t.data)||a.message),m.error("Failed to add subCat. Check required fields.")}else m.error("Please fill required fields")};return e.jsxs(N,{open:x,onClose:u,children:[e.jsx(k,{children:"Add New subCat"}),e.jsxs(D,{children:[e.jsx(h,{label:"subCat Name Arabic",name:"nameAr",fullWidth:!0,margin:"dense",value:s.nameAr,onChange:p}),e.jsx(h,{label:"subCat Name English",name:"nameEn",fullWidth:!0,margin:"dense",value:s.nameEn,onChange:p}),e.jsx(h,{className:"mt-4",label:"Upload Image",type:"file",name:"image",fullWidth:!0,margin:"dense",onChange:A,InputLabelProps:{shrink:!0}}),e.jsx(h,{label:"Description English",name:"descriptionEn",fullWidth:!0,margin:"dense",multiline:!0,rows:4,value:s.descriptionEn,onChange:p}),e.jsx(h,{label:"Description Arabic",name:"descriptionAr",fullWidth:!0,margin:"dense",multiline:!0,rows:4,value:s.descriptionAr,onChange:p}),e.jsxs(h,{select:!0,label:"Select a category",name:"categoryId",fullWidth:!0,margin:"normal",value:s.categoryId,onChange:p,SelectProps:{native:!0},children:[e.jsx("option",{value:""}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs(h,{select:!0,label:"Select status",name:"status",fullWidth:!0,margin:"normal",value:s.status,onChange:t=>{const a=t.target.value==="true";l(r=>({...r,status:a}))},SelectProps:{native:!0},children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs(w,{children:[e.jsx(y,{onClick:u,children:"Cancel"}),e.jsx(y,{onClick:o,variant:"contained",children:"Add"})]})]})},U=({open:x,onClose:u,onSave:j,initialData:n})=>{const[s,l]=d.useState({nameEn:"",nameAr:"",descriptionEn:"",descriptionAr:"",image:null,status:"true",id:""}),[b,v]=d.useState([]);d.useEffect(()=>{(async()=>{try{const[t]=await Promise.all([W()]);v(t)}catch{m.error("Error fetching data")}})()},[]),d.useEffect(()=>{x&&n&&l({nameEn:n.name||"",nameAr:n.nameAr||n.name||"",categoryId:n.categoryId||n.categoryId||"",descriptionEn:n.descriptionEn||n.description||"",descriptionAr:n.descriptionAr||n.description||"",categoryId:n.categoryId||"",image:n.imageUrl||"",status:n.isActive?"true":"false",id:n.id||""})},[x,n]);const g=o=>{const{name:t,value:a,type:r,files:f}=o.target;l(r==="file"?C=>({...C,image:f[0]}):C=>({...C,[t]:a}))},A=o=>{const t=o.target.files[0];t&&t.type.startsWith("image/")?setProduct(a=>({...a,image:t})):m.error("Please select a valid image")},p=async()=>{var o;if(!s.nameEn){m.error("Please fill required fields");return}try{const t=new FormData;t.append("Name",s.nameEn),t.append("NameAr",s.nameAr),t.append("CategoryId",s.categoryId),t.append("Description",s.descriptionEn),t.append("DescriptionAr",s.descriptionAr),t.append("CategoryId",s.categoryId),t.append("IsActive",s.status==="true"?"true":"false"),s.image instanceof File&&t.append("Image",s.image);const a=sessionStorage.getItem("token"),r=await E.put(`http://test.smartsto0re.shop/api/SubCategories/${s.id}`,t,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}});m.success("Sub Category updated successfully"),j==null||j(r.data),u()}catch(t){const a=(o=t.response)==null?void 0:o.data;if(console.error("❌ Full Error:",a||t.message),a!=null&&a.errors)for(const r in a.errors)m.error(`${r}: ${a.errors[r].join(", ")}`);else m.error((a==null?void 0:a.title)||"Request failed - check the fields")}};return e.jsxs(N,{open:x,onClose:u,fullWidth:!0,maxWidth:"sm",children:[e.jsx(k,{children:"Edit Sub Category"}),e.jsxs(D,{children:[e.jsx(h,{label:"Arabic Name",name:"nameAr",fullWidth:!0,margin:"dense",value:s.nameAr,onChange:g}),e.jsx(h,{label:"English Name",name:"nameEn",fullWidth:!0,margin:"dense",value:s.nameEn,onChange:g}),s.imageUrl&&e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("img",{src:`http://test.smartsto0re.shop${s.imageUrl}`,alt:"Sub Category",style:{width:"100px",borderRadius:"6px"}})}),e.jsx("label",{style:{display:"block",marginTop:"1rem"},children:"Upload New Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,style:{marginBottom:"1rem"}}),e.jsx(h,{label:"English Description",name:"descriptionEn",fullWidth:!0,margin:"dense",multiline:!0,rows:3,value:s.descriptionEn,onChange:g}),e.jsx(h,{label:"Arabic Description",name:"descriptionAr",fullWidth:!0,margin:"dense",multiline:!0,rows:3,value:s.descriptionAr,onChange:g}),e.jsxs(h,{select:!0,label:"Select Category",name:"categoryId",fullWidth:!0,margin:"normal",value:s.categoryId,onChange:g,SelectProps:{native:!0},children:[e.jsx("option",{value:""}),b.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),e.jsxs(h,{select:!0,label:"Status",name:"status",fullWidth:!0,margin:"normal",value:s.status,onChange:g,SelectProps:{native:!0},children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs(w,{children:[e.jsx(y,{onClick:u,children:"Cancel"}),e.jsx(y,{variant:"contained",onClick:p,children:"Save Changes"})]})]})},q=({open:x,onClose:u,onConfirm:j,subCat:n})=>{const s=async()=>{try{const l=sessionStorage.getItem("token"),b=await E.delete(`http://test.smartsto0re.shop/api/SubCategories/${n.id}`,{headers:{Authorization:`Bearer ${l}`}});m.success("subCat deleted successfully"),j(n.id),u()}catch(l){console.error("❌ Error deleting subCat:",l),m.error("Failed to delete subCat")}};return e.jsxs(N,{open:x,onClose:u,className:"delete-dialog",children:[e.jsx(k,{children:"Confirm Deletion"}),e.jsxs(D,{children:["Are you sure you want to delete ",e.jsx("strong",{children:(n==null?void 0:n.name)||"this subCat"}),"?"]}),e.jsxs(w,{children:[e.jsx(y,{onClick:u,color:"inherit",children:"Cancel"}),e.jsx(y,{onClick:s,color:"error",variant:"contained",children:"Delete"})]})]})};function G(){T();const[x,u]=d.useState(!1),[j,n]=d.useState(!1),[s,l]=d.useState(!1),[b,v]=d.useState(null),[g,A]=d.useState(null),[p,o]=d.useState([]),[t,a]=d.useState(1),r=5,f=Math.ceil(p.length/r),C=t*r,S=C-r,P=p.slice(S,C);d.useEffect(()=>{(async()=>{try{const c=sessionStorage.getItem("token"),I=await E.get("http://test.smartsto0re.shop/api/SubCategories",{headers:{Authorization:`Bearer ${c}`}});o(I.data)}catch(c){console.error("❌ Error fetching subCats:",c),m.error("Failed to bring the subCats.")}})()},[]);const B=i=>{o(c=>[...c,i])},F=i=>{o(p.map(c=>c.id===i.id?i:c))},$=i=>{o(c=>c.filter(I=>I.id!==i)),l(!1),v(null)};return console.log(P,"currentsubCats"),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"header",children:[e.jsx("p",{children:"Add a New SubCategories"}),e.jsx(y,{variant:"contained",color:"primary",onClick:()=>u(!0),children:"ADD THE subCats"})]}),e.jsxs("table",{className:"subCats_table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"NameEn"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Edit"}),e.jsx("th",{children:"Delete"})]})}),e.jsx("tbody",{children:P.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{className:"image",src:`http://test.smartsto0re.shop${i.imageUrl}`,alt:i.name})}),e.jsx("td",{children:i.name}),e.jsx("td",{children:e.jsx("span",{className:i.isActive===!0?"active":"inactive",children:i.isActive?"Active":"Inactive"})}),e.jsx("td",{children:e.jsx("button",{className:"button editButton",onClick:()=>{A(i),n(!0)},children:e.jsx("i",{className:"fas fa-edit"})})}),e.jsx("td",{children:e.jsx("button",{className:"button deleteButton",onClick:()=>{v(i),l(!0)},children:e.jsx("i",{className:"fas fa-trash"})})})]},i.id))})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"pageBtn",onClick:()=>a(i=>Math.max(i-1,1)),disabled:t===1,children:"<<"}),[...Array(f)].map((i,c)=>e.jsx("button",{className:`pageBtn ${t===c+1?"pageBtnActive":"pageBtnInactive"}`,onClick:()=>a(c+1),children:c+1},c)),e.jsx("button",{className:"pageBtn",onClick:()=>a(i=>Math.min(i+1,f)),disabled:t===f,children:">"})]}),e.jsx(O,{open:x,onClose:()=>u(!1),onSave:B}),e.jsx(U,{open:j,onClose:()=>n(!1),onSave:F,initialData:g}),e.jsx(q,{open:s,className:"delete-dialog",onClose:()=>l(!1),onConfirm:$,subCat:b})]})}export{G as default};
